    /**
     * @test
     */

    public function can_automatically_delete_temp_file_on_failure_when_using_remote_disk()
    {
        config()->set('excel.temporary_files.remote_disk', 'test');
        $tempFile = '';

        Queue::exceptionOccurred(function (JobExceptionOccurred $event) use (&$tempFile) {
            if ($event->job->resolveName() === ReadChunk::class) {
                $tempFile = $this->inspectJobProperty($event->job, 'temporaryFile');
            }
        });

        try {
            (new QueuedImportWithFailure())->queue('import-batches.xlsx');
        } catch (Throwable $e) {
            $this->assertEquals('Something went wrong in the chunk', $e->getMessage());
        }

        $this->assertFalse($tempFile->existsLocally());
        $this->assertTrue($tempFile->exists());
    }
