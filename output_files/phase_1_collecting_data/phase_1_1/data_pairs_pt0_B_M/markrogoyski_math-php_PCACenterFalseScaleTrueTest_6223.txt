    /**
     * @test The class returns the correct Q residuals
     *
     * R code for expected values:
     *   model$calres$Q
     *
     * @throws \Exception
     */

    public function testGetQResiduals()
    {
        // Given
        $expected = [
            [ 2.473497, 2.0383460, 0.59444134, 0.57045496, 0.48083697, 0.26977349, 0.107203856, 2.558371e-02, 2.672266e-29],
            [ 1.936930, 1.5865233, 0.62117520, 0.51872227, 0.42630916, 0.25470606, 0.067667784, 4.742659e-03, 2.534216e-29],
            [ 5.732423, 0.4863844, 0.40159844, 0.40065137, 0.40060152, 0.21599422, 0.046320946, 1.613528e-02, 1.869847e-29],
            [ 4.164362, 4.1137130, 0.26634012, 0.22252246, 0.02563783, 0.02495414, 0.024183808, 2.072585e-02, 3.112303e-29],
            [ 4.199089, 1.7980082, 1.14282032, 0.09971110, 0.03831263, 0.03042401, 0.026520065, 2.547300e-02, 2.312349e-29],
            [ 6.767451, 6.7666322, 0.84546356, 0.63187407, 0.13270614, 0.12982782, 0.070136846, 9.981166e-06, 4.675233e-29],
            [ 7.900537, 0.8085684, 0.66556037, 0.44761365, 0.43461334, 0.31081415, 0.132367004, 3.063971e-02, 2.484912e-29],
            [ 5.351454, 1.6407690, 0.95473739, 0.33655915, 0.31824605, 0.16444037, 0.009127303, 2.727619e-05, 1.983246e-29],
            [ 7.806246, 3.8560715, 1.81034682, 0.38092374, 0.38024571, 0.31933958, 0.047406396, 3.782973e-02, 1.903127e-29],
            [ 1.244849, 1.1850989, 0.90113146, 0.35013230, 0.17938945, 0.13164998, 0.070504511, 1.076438e-02, 2.233462e-29],
            [ 1.425924, 1.3850464, 1.26329311, 0.38988343, 0.18857512, 0.14697632, 0.143629871, 2.328566e-04, 3.096279e-29],
            [ 4.386930, 0.8728449, 0.34675789, 0.34342332, 0.32747998, 0.17138850, 0.163546193, 1.556817e-01, 2.958228e-29],
            [ 3.713175, 0.9487391, 0.44016163, 0.41109599, 0.34607573, 0.04148057, 0.040693808, 3.654411e-02, 1.794659e-29],
            [ 4.286700, 1.1091602, 0.38703319, 0.38505064, 0.36095305, 0.12929515, 0.082977565, 1.955328e-02, 2.090481e-29],
            [15.794192, 1.8613370, 0.81801086, 0.52980634, 0.48750335, 0.17552706, 0.078337065, 6.145292e-02, 2.647614e-29],
            [16.158791, 1.7026127, 0.85476689, 0.57658313, 0.47317818, 0.12636981, 0.041752833, 5.908191e-04, 2.509564e-29],
            [13.137723, 1.2349676, 0.91692980, 0.91247520, 0.77405841, 0.63783744, 0.457724962, 5.113651e-02, 3.628760e-29],
            [11.939326, 0.7645604, 0.57712353, 0.39807835, 0.33476884, 0.31818197, 0.236965192, 4.657828e-02, 2.505866e-29],
            [16.220394, 2.4346057, 1.94183382, 1.49077681, 0.32126733, 0.13065726, 0.083042230, 6.176228e-02, 2.001735e-29],
            [14.729436, 0.9396899, 0.78143531, 0.43641557, 0.37853621, 0.25482814, 0.232101734, 8.965368e-04, 2.959461e-29],
            [ 6.887468, 3.2643328, 0.87675212, 0.81310529, 0.63341195, 0.60372646, 0.052229183, 4.295298e-03, 4.468157e-29],
            [ 4.737917, 1.9145719, 0.75446122, 0.55134824, 0.27176293, 0.26284389, 0.251745728, 2.126856e-03, 1.735494e-29],
            [ 3.558261, 1.5800895, 0.67899366, 0.39032785, 0.38997804, 0.36139401, 0.355729941, 2.403657e-03, 1.636886e-29],
            [ 8.922244, 2.1813870, 1.60159446, 1.19222322, 0.24165680, 0.19751654, 0.058811953, 8.612602e-03, 2.169367e-29],
            [ 5.680917, 2.2394028, 1.29168181, 0.26513288, 0.17746673, 0.15408112, 0.037398616, 1.796853e-02, 2.267975e-29],
            [ 9.779093, 0.1434924, 0.09245221, 0.01829305, 0.01702962, 0.01660558, 0.004546499, 5.626917e-04, 1.366948e-29],
            [10.993023, 3.6675032, 0.91881036, 0.78430118, 0.76206897, 0.12297833, 0.068550788, 8.499181e-03, 1.899429e-29],
            [12.365115, 3.9048544, 1.78435854, 1.59628661, 0.14003310, 0.04658704, 0.044445325, 1.353218e-03, 3.841999e-29],
            [13.973532,11.1248050, 2.29539336, 1.12237753, 1.10245751, 0.37878854, 0.211206692, 1.011770e-03, 4.279570e-29],
            [ 9.569292, 9.5546657, 1.46988373, 0.55677121, 0.15973073, 0.08461858, 0.018191160, 1.434913e-03, 2.997671e-29],
            [26.690631,16.9872246, 1.56301004, 1.07311749, 0.56562699, 0.46568549, 0.261932119, 3.266041e-03, 6.054507e-29],
            [ 4.072633, 0.7343156, 0.72327092, 0.59239436, 0.30373671, 0.13817742, 0.032154751, 3.205959e-02, 1.464323e-29],
        ];

        // When
        $qResiduals = self::$pca->getQResiduals()->getMatrix();

        // Then
        $this->assertEqualsWithDelta($expected, $qResiduals, .00001);
    }
