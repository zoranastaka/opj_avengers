    /**
     * @test The class returns the correct Q residuals
     *
     * R code for expected values:
     *   model$calres$Q
     *
     * @throws \Exception
     */

    public function testGetQResiduals()
    {
        // Given
        $expected = [
            [2.2230939, 0.8461148, 0.80436922, 0.78848881, 0.22297302, 0.20733107, 0.0279166962, 0.02790607, 4.999714E-31],
            [1.6191345, 0.6647133, 0.65244159, 0.64510102, 0.21386161, 0.20947992, 0.008333885, 0.005125428, 6.842829E-31],
            [0.6928714, 0.5862109, 0.54204804, 0.53024859, 0.5244386, 0.20302164, 0.053929844, 0.0131114, 1.57464E-30],
            [4.2005024, 0.2927243, 0.18417497, 0.08927262, 0.0297767, 0.02275017, 0.0216615939, 0.02109923, 2.915298E-30],
            [1.9090817, 1.2222907, 0.1552171, 0.133495, 0.08389791, 0.05048048, 0.0471236715, 0.02391541, 1.932863E-30],
            [6.8874241, 0.9011625, 0.88866819, 0.12907029, 0.11325754, 0.06015945, 0.00975234, 0.00001792591, 2.53645E-30],
            [1.0543916, 0.9240324, 0.49884964, 0.48956953, 0.40151351, 0.324432, 0.1288265333, 0.03496182, 2.948984E-30],
            [1.7331133, 1.092087, 0.37130642, 0.29594882, 0.22673854, 0.19047676, 0.0351114957, 0.0001094394, 1.131099E-30],
            [6.3233872, 4.6187948, 0.74386353, 0.74130734, 0.52981669, 0.4880216, 0.199508412, 0.02856295, 3.754023E-30],
            [1.4667281, 1.1290264, 0.34345841, 0.33852062, 0.12842808, 0.12205208, 0.0538610506, 0.01220181, 7.749942E-31],
            [1.8836417, 1.7137353, 0.39443148, 0.39064813, 0.15727144, 0.13145834, 0.1250910774, 0.0007348581, 1.165573E-30],
            [0.8955959, 0.3712463, 0.32879143, 0.28102, 0.20264125, 0.17328022, 0.1653334295, 0.1568436, 1.146506E-30],
            [0.9658784, 0.4554604, 0.34889684, 0.26518138, 0.18643504, 0.07298456, 0.071864583, 0.0386227, 2.124879E-30],
            [1.0889335, 0.3813688, 0.37404503, 0.29326566, 0.17103365, 0.15163957, 0.1090696882, 0.02184374, 2.317664E-30],
            [2.0933538, 1.1944834, 0.41451424, 0.3676602, 0.24663799, 0.1890274, 0.0925978287, 0.06306016, 5.534352E-30],
            [2.0041095, 1.2939754, 0.42478607, 0.30851175, 0.19113367, 0.13984858, 0.0581115149, 0.0008406744, 4.42474E-30],
            [1.721029, 1.4900902, 1.04035958, 0.61538957, 0.42231067, 0.32592681, 0.1792040337, 0.04977268, 5.090618E-30],
            [0.8024469, 0.6152112, 0.56411615, 0.55408006, 0.44205395, 0.11368574, 0.0529205643, 0.0485195, 4.009016E-30],
            [2.5132733, 2.0114213, 1.96002398, 0.53581226, 0.24470541, 0.10626855, 0.066047095, 0.05841994, 4.686943E-30],
            [1.0798441, 0.9299116, 0.86494292, 0.81670863, 0.72446038, 0.02303907, 0.0126618472, 0.001834703, 8.184432E-30],
            [3.4713395, 0.9983825, 0.99399948, 0.98761599, 0.73634868, 0.73114719, 0.1734249687, 0.006843071, 2.761784E-30],
            [2.8189495, 1.5327746, 0.51718598, 0.1714862, 0.16167781, 0.04661511, 0.0268876607, 0.002524814, 2.742524E-30],
            [1.8573293, 0.9013091, 0.31332158, 0.31222677, 0.24001968, 0.14092384, 0.1395150215, 0.001889296, 2.143608E-30],
            [2.2534341, 1.6682712, 1.42900208, 0.5217925, 0.24019284, 0.23662866, 0.0906111425, 0.006735459, 3.858793E-30],
            [2.2411472, 1.2824005, 0.4762186, 0.4258689, 0.16809947, 0.12489381, 0.0179048904, 0.01715023, 3.575296E-30],
            [0.2224428, 0.1572867, 0.02602148, 0.02191769, 0.02078788, 0.01159734, 0.0008803955, 0.0004445673, 1.98756E-30],
            [3.6628254, 0.9819534, 0.85256946, 0.75089431, 0.56382916, 0.08763924, 0.0184012158, 0.007229636, 5.472723E-30],
            [4.2415698, 2.2920927, 1.45239473, 0.63781061, 0.0623191, 0.05932328, 0.0581045197, 0.002147493, 5.016662E-30],
            [11.5884126, 2.463795, 2.19396446, 1.44468638, 0.70425347, 0.44716216, 0.3032110286, 0.00282989, 3.386989E-30],
            [9.655183, 1.6199041, 1.50100503, 0.1863213, 0.09665368, 0.0900528, 0.0175574295, 0.002295877, 5.777982E-30],
            [17.7579146, 1.7627973, 1.26863739, 0.73573085, 0.68394696, 0.25386039, 0.0095990062, 0.002820893, 9.523531E-30],
            [0.737494, 0.7257394, 0.56648268, 0.46860262, 0.45482227, 0.22353991, 0.1268036408, 0.02748662, 2.271057E-30],
        ];

        // When
        $qResiduals = self::$pca->getQResiduals()->getMatrix();

        // Then
        $this->assertEqualsWithDelta($expected, $qResiduals, .00001);
    }
