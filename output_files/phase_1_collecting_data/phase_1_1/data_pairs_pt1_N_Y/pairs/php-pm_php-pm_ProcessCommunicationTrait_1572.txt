    /**
     * Binds data-listener to $conn and waits for incoming commands.
     *
     * @param ConnectionInterface $conn
     */

    protected function bindProcessMessage(ConnectionInterface $conn)
    {
        $buffer = '';

        $conn->on('data', function ($data) use ($conn, &$buffer) {
            $buffer .= $data;

            if (\substr($buffer, -\strlen(PHP_EOL)) === PHP_EOL) {
                foreach (\explode(PHP_EOL, $buffer) as $message) {
                    if ($message) {
                        $this->processMessage($conn, $message);
                    }
                }

                $buffer = '';
            }
        });
    }
